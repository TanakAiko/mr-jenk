<div class="container">
  <div class="cart-header">
    <h1>Shopping Cart</h1>
    <p class="subtitle" *ngIf="(cartItems$ | async)?.length as count">
      You have {{ count }} item{{ count !== 1 ? 's' : '' }} in your cart
    </p>
  </div>

  <ng-container *ngIf="cartItems$ | async as cartItems">
    <div class="cart-layout" *ngIf="cartItems.length > 0; else emptyCart">
      
      <!-- Cart Items List -->
      <div class="cart-items-section">
        <div class="cart-item" *ngFor="let item of cartItems">
          <!-- Product Image -->
          <div class="item-image-container">
            <img 
              [src]="item.product.images && item.product.images.length > 0 ? item.product.images[0].imageUrl : 'assets/images/placeholder.png'" 
              [alt]="item.product.name"
              class="item-image"
            >
          </div>

          <!-- Product Details -->
          <div class="item-details">
            <div class="item-info">
              <h3 class="item-title">
                <a [routerLink]="['/products', item.product.id]">{{ item.product.name }}</a>
              </h3>
              <p class="item-price">{{ item.product.price | currency }}</p>
            </div>

            <!-- Quantity Controls -->
            <div class="item-actions">
              <div class="quantity-selector">
                <button 
                  class="qty-btn" 
                  (click)="updateQuantity(item.product.id, item.quantity - 1)"
                  [disabled]="item.quantity <= 1"
                  aria-label="Decrease quantity"
                >
                  <lucide-icon [img]="Minus" [size]="16"></lucide-icon>
                </button>
                <span class="qty-value">{{ item.quantity }}</span>
                <button 
                  class="qty-btn" 
                  (click)="updateQuantity(item.product.id, item.quantity + 1)"
                  aria-label="Increase quantity"
                >
                  <lucide-icon [img]="Plus" [size]="16"></lucide-icon>
                </button>
              </div>

              <button 
                class="remove-btn" 
                (click)="removeItem(item.product.id)"
                aria-label="Remove item"
              >
                <lucide-icon [img]="Trash2" [size]="18"></lucide-icon>
                <span class="remove-text">Remove</span>
              </button>
            </div>
          </div>

          <!-- Item Subtotal -->
          <div class="item-subtotal">
            <span class="label">Subtotal:</span>
            <span class="value">{{ getSubtotal(item) | currency }}</span>
          </div>
        </div>
      </div>

      <!-- Order Summary -->
      <div class="order-summary-section">
        <div class="summary-card">
          <h2>Order Summary</h2>
          
          <div class="summary-row">
            <span>Subtotal</span>
            <span>{{ cartTotal | currency }}</span>
          </div>
          
          <div class="summary-row">
            <span>Shipping</span>
            <span class="free-shipping">Free</span>
          </div>
          
          <div class="divider"></div>
          
          <div class="summary-row total">
            <span>Total</span>
            <span>{{ cartTotal | currency }}</span>
          </div>

          <button class="checkout-btn">
            Proceed to Checkout
            <lucide-icon [img]="ArrowRight" [size]="20"></lucide-icon>
          </button>
          
          <div class="secure-checkout">
            <p>Secure Checkout</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <ng-template #emptyCart>
      <div class="empty-state">
        <div class="empty-icon">
          <lucide-icon [img]="ShoppingBag" [size]="64"></lucide-icon>
        </div>
        <h2>Your cart is empty</h2>
        <p>Looks like you haven't added anything to your cart yet.</p>
        <a routerLink="/products" class="continue-shopping-btn">
          Start Shopping
        </a>
      </div>
    </ng-template>
  </ng-container>
</div>
